# Flow Service API 测试用例文档

## 测试概述

本文档描述了 Flow Service API 的端到端测试用例，涵盖了系统监控、节点管理、工作流管理和执行管理等核心功能。

**API 基础信息:**

- 基础 URL: `http://localhost:8800`
- 认证方式: 无需认证（测试环境）
- 内容类型: `application/json`

## 测试用例列表

### 1. 系统监控测试

#### TC-001: 健康检查

- **测试 ID**: TC-001
- **描述**: 验证系统基础健康检查接口
- **端点**: `/health`
- **方法**: GET
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: "OK"

#### TC-002: 系统准备状态检查

- **测试 ID**: TC-002
- **描述**: 验证系统准备状态检查接口
- **端点**: `/ready`
- **方法**: GET
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: JSON 格式，包含 ready 状态

#### TC-003: 系统存活状态检查

- **测试 ID**: TC-003
- **描述**: 验证系统存活状态检查接口
- **端点**: `/live`
- **方法**: GET
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: JSON 格式，包含 alive 状态

#### TC-004: 系统信息获取

- **测试 ID**: TC-004
- **描述**: 获取系统基本信息
- **端点**: `/info`
- **方法**: GET
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: JSON 格式，包含系统信息

#### TC-005: 系统版本信息

- **测试 ID**: TC-005
- **描述**: 获取系统版本信息
- **端点**: `/version`
- **方法**: GET
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: JSON 格式，包含版本信息

### 2. 节点管理测试

#### TC-006: 获取节点完整信息列表

- **测试 ID**: TC-006
- **描述**: 获取所有节点的完整信息，包括元数据和配置模式
- **端点**: `/nodes`
- **方法**: GET
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: JSON 格式，包含 nodes 数组、分页信息、分类和类型

#### TC-007: 节点分页查询

- **测试 ID**: TC-007
- **描述**: 测试节点分页查询功能
- **端点**: `/nodes?page=1&size=5`
- **方法**: GET
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: 包含最多 5 个节点的分页结果

#### TC-008: 按分类过滤节点

- **测试 ID**: TC-008
- **描述**: 按分类过滤节点列表
- **端点**: `/nodes?category=datasource`
- **方法**: GET
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: 只包含 datasource 分类的节点

#### TC-009: 按类型过滤节点

- **测试 ID**: TC-009
- **描述**: 按类型过滤节点列表
- **端点**: `/nodes?type=postgresql`
- **方法**: GET
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: 只包含 postgresql 类型的节点

#### TC-010: 搜索节点

- **测试 ID**: TC-010
- **描述**: 通过关键词搜索节点
- **端点**: `/nodes?search=数据`
- **方法**: GET
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: 包含关键词"数据"的节点

#### TC-011: 获取节点分类列表

- **测试 ID**: TC-011
- **描述**: 获取所有节点分类
- **端点**: `/nodes/categories`
- **方法**: GET
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: 包含所有分类信息的数组

#### TC-012: 获取节点类型列表

- **测试 ID**: TC-012
- **描述**: 获取所有节点类型
- **端点**: `/nodes/types`
- **方法**: GET
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: 包含所有类型信息的数组

#### TC-013: 获取注册表统计信息

- **测试 ID**: TC-013
- **描述**: 获取节点注册表统计信息
- **端点**: `/nodes/stats`
- **方法**: GET
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: 包含节点统计信息

#### TC-014: 验证节点配置（有效配置）

- **测试 ID**: TC-014
- **描述**: 验证有效的节点配置
- **端点**: `/nodes/postgresql/validate`
- **方法**: POST
- **请求数据**:
  ```json
  {
    "host": "localhost",
    "port": 5432,
    "database": "test_db",
    "username": "test_user",
    "password": "test_pass"
  }
  ```
- **预期响应**:
  - 状态码: 200
  - 响应体: valid 为 true

#### TC-015: 验证节点配置（无效配置）

- **测试 ID**: TC-015
- **描述**: 验证无效的节点配置
- **端点**: `/nodes/postgresql/validate`
- **方法**: POST
- **请求数据**:
  ```json
  {
    "host": "",
    "port": "invalid_port"
  }
  ```
- **预期响应**:
  - 状态码: 200
  - 响应体: valid 为 false，包含错误信息

### 3. 工作流管理测试

#### TC-016: 创建工作流

- **测试 ID**: TC-016
- **描述**: 创建新的工作流
- **端点**: `/workflows`
- **方法**: POST
- **请求数据**:
  ```json
  {
    "name": "测试工作流",
    "description": "这是一个测试工作流",
    "version": "1.0.0",
    "nodes": {
      "node1": {
        "id": "node1",
        "name": "数据源节点",
        "type": "postgresql",
        "plugin": "postgresql",
        "config": {
          "host": "localhost",
          "port": 5432,
          "database": "test_db"
        }
      }
    },
    "edges": [],
    "status": "inactive"
  }
  ```
- **预期响应**:
  - 状态码: 201
  - 响应体: 创建的工作流信息

#### TC-017: 获取工作流列表

- **测试 ID**: TC-017
- **描述**: 获取所有工作流列表
- **端点**: `/workflows`
- **方法**: GET
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: 工作流列表数组

#### TC-018: 获取工作流详情

- **测试 ID**: TC-018
- **描述**: 获取指定工作流的详细信息
- **端点**: `/workflows/{workflow_id}`
- **方法**: GET
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: 工作流详细信息

#### TC-019: 更新工作流

- **测试 ID**: TC-019
- **描述**: 更新现有工作流
- **端点**: `/workflows/{workflow_id}`
- **方法**: PUT
- **请求数据**:
  ```json
  {
    "name": "更新后的测试工作流",
    "description": "这是更新后的测试工作流",
    "version": "1.0.1"
  }
  ```
- **预期响应**:
  - 状态码: 200
  - 响应体: 更新后的工作流信息

#### TC-020: 激活工作流

- **测试 ID**: TC-020
- **描述**: 激活工作流
- **端点**: `/workflows/{workflow_id}/activate`
- **方法**: POST
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: 成功信息

#### TC-021: 停用工作流

- **测试 ID**: TC-021
- **描述**: 停用工作流
- **端点**: `/workflows/{workflow_id}/deactivate`
- **方法**: POST
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: 成功信息

#### TC-022: 暂停工作流

- **测试 ID**: TC-022
- **描述**: 暂停工作流
- **端点**: `/workflows/{workflow_id}/pause`
- **方法**: POST
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: 成功信息

#### TC-023: 恢复工作流

- **测试 ID**: TC-023
- **描述**: 恢复暂停的工作流
- **端点**: `/workflows/{workflow_id}/resume`
- **方法**: POST
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: 成功信息

#### TC-024: 触发工作流执行

- **测试 ID**: TC-024
- **描述**: 手动触发工作流执行
- **端点**: `/workflows/{workflow_id}/trigger`
- **方法**: POST
- **请求数据**:
  ```json
  {
    "trigger_type": "manual",
    "input": {
      "test_param": "test_value"
    }
  }
  ```
- **预期响应**:
  - 状态码: 200
  - 响应体: 执行记录信息

#### TC-025: 获取工作流执行列表

- **测试 ID**: TC-025
- **描述**: 获取指定工作流的执行记录列表
- **端点**: `/workflows/{workflow_id}/executions`
- **方法**: GET
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: 执行记录列表

#### TC-026: 获取工作流统计信息

- **测试 ID**: TC-026
- **描述**: 获取工作流的统计信息
- **端点**: `/workflows/{workflow_id}/statistics`
- **方法**: GET
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: 统计信息

#### TC-027: 删除工作流

- **测试 ID**: TC-027
- **描述**: 删除工作流
- **端点**: `/workflows/{workflow_id}`
- **方法**: DELETE
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: 删除成功信息

### 4. 执行管理测试

#### TC-028: 获取所有执行记录

- **测试 ID**: TC-028
- **描述**: 获取所有执行记录列表
- **端点**: `/executions`
- **方法**: GET
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: 执行记录列表

#### TC-029: 获取执行记录详情

- **测试 ID**: TC-029
- **描述**: 获取指定执行记录的详细信息
- **端点**: `/executions/{execution_id}`
- **方法**: GET
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: 执行记录详细信息

#### TC-030: 取消执行

- **测试 ID**: TC-030
- **描述**: 取消正在执行的任务
- **端点**: `/executions/{execution_id}/cancel`
- **方法**: POST
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: 取消成功信息

#### TC-031: 重试执行

- **测试 ID**: TC-031
- **描述**: 重试失败的执行
- **端点**: `/executions/{execution_id}/retry`
- **方法**: POST
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: 新的执行记录信息

#### TC-032: 获取执行进度

- **测试 ID**: TC-032
- **描述**: 获取执行的进度信息
- **端点**: `/executions/{execution_id}/progress`
- **方法**: GET
- **请求数据**: 无
- **预期响应**:
  - 状态码: 200
  - 响应体: 进度信息

### 5. 错误处理测试

#### TC-033: 访问不存在的端点

- **测试 ID**: TC-033
- **描述**: 访问不存在的 API 端点
- **端点**: `/nonexistent`
- **方法**: GET
- **请求数据**: 无
- **预期响应**:
  - 状态码: 404
  - 响应体: 错误信息

#### TC-034: 获取不存在的工作流

- **测试 ID**: TC-034
- **描述**: 获取不存在的工作流
- **端点**: `/workflows/nonexistent-id`
- **方法**: GET
- **请求数据**: 无
- **预期响应**:
  - 状态码: 404
  - 响应体: 工作流不存在错误信息

#### TC-035: 创建无效的工作流

- **测试 ID**: TC-035
- **描述**: 创建缺少必填字段的工作流
- **端点**: `/workflows`
- **方法**: POST
- **请求数据**:
  ```json
  {
    "description": "缺少name字段的工作流"
  }
  ```
- **预期响应**:
  - 状态码: 400
  - 响应体: 验证错误信息

## 测试数据说明

- 所有测试用例使用模拟数据，不会对生产环境造成影响
- 测试执行前需要确保服务已启动并可访问
- 某些测试用例（如工作流管理）可能需要依赖其他用例的执行结果
- 测试数据中的 ID（如 workflow_id、execution_id）将在实际测试中动态获取

## 注意事项

1. 测试执行顺序：建议按照文档顺序执行测试用例
2. 数据依赖：某些测试用例需要先创建数据才能进行后续测试
3. 清理工作：测试完成后需要清理创建的测试数据
4. 错误处理：如果测试失败，需要检查服务状态和测试数据
